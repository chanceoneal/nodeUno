<!doctype html>
<html>
  <head>
    <title>Josh's UNO Bonanza</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <div class="page-header">
        <h1>Josh's Uno Bonanza <small>Pls don't tell Mattel or they'll totally sue me</small></h1>
    </div>
    
    <div class="btn-group" role="group" aria-label="...">
        <button type="button" class="btn btn-default" id="newGame">New Game</button>
        <button type="button" class="btn btn-default" id="drawCard">Draw Card</button>
        <button type="button" class="btn btn-default" id="draw2Cards">Draw 2 Cards</button>
        <button type="button" class="btn btn-default" id="draw4Cards">Draw 4 Cards</button>
        <button type="button" class="btn btn-default" id="draw7Cards">Draw 7 Cards</button>
        <button type="button" class="btn btn-default" id="unoCall">Call Uno</button>
        <button type="button" class="btn btn-default" id="undoCard">Undo Card</button>
    </div>
    
    <br>
    <div class="col-md-4">
        <h2>Global Messages (Visible to all players)</h2>
        <ul class="list-group" id="messages"></ul>
    </div>
    
    <div class="col-md-3">
        <h2>Current Card</h2>
        <div id="imageContainer">
        </div>
    </div>
    
    <div class="col-md-5">
        <h2>Your Cards (Visible to only you)</h2>
        <ul class="list-group" id="cards"></ul>
    </div>
    
    <br>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
        var username = prompt('Enter your name');
    
      $(function () {
        var socket = io();
        // Handle username
        socket.emit('new user', username);
        
        // New Game
        $("#newGame").click(function() {
            socket.emit('new game');
            console.log('New Game Button Clicked -- Client');
        });
        
        // Draw cards
        $("#drawCard").click(function() {
            socket.emit('card get');
            console.log("Draw Card Button Clicked -- Client");
        });
        
        $("#draw2Cards").click(function() {
            socket.emit('card get x', 2);
            console.log("Draw Card 2 Button Clicked -- Client");
        });
        
        $("#draw4Cards").click(function() {
            socket.emit('card get x', 4);
            console.log("Draw Card 4 Button Clicked -- Client");
        });
        
        $("#draw7Cards").click(function() {
            socket.emit('card get x', 7);
            console.log("Draw Card 7 Button Clicked -- Client");
        });
        
        // Call uo
        $("#unoCall").click(function() {
            socket.emit('call uno');
            console.log("Uno Call Button Clicked -- Client");
        });
        
        // Undo Card
        $("#undoCard").click(function() {
            socket.emit('card undo');
            console.log("Undo Card Button Clicked -- Client");
        });
        
        socket.on('card get', function(card){
            var tempCard = $('<li>').text(JSON.stringify(card));
            tempCard.addClass("list-group-item");
            var tempColor = getColor(card);
            var tempUrl = getURL(card);
            var tempImageString = '<img class="' + tempColor + '" src="' + tempUrl +  '" alt=' + JSON.stringify(card) + '>';
            var tempImage = $(tempImageString);
            $(tempCard).append(tempImage);
            tempCard.click(function(e) {
                // Handles the user clicking on the img
                if (e.target.tagName == 'IMG') {
                    var tempLi = $(e.target).parent()[0];
                } else {
                    var tempLi = e.target;
                }
                socket.emit('card play', JSON.parse(tempLi.innerText));
                tempLi.remove();
                victoryCheck();
            });
            $('#cards').append(tempCard);
        });
        
        socket.on('display card', function(card) {
            var tempColor = getColor(card);
            var tempUrl = getURL(card);
            var tempImageString = '<img class="' + tempColor + '" src="' + tempUrl +  '" alt=' + JSON.stringify(card) + '>';
            var tempImage = $(tempImageString);
            $('#imageContainer').empty();
            $('#imageContainer').append(tempImage);
        });
        
        socket.on('message', function(msg){
            var tempLi = $('<li>').text(msg);
            tempLi.addClass("list-group-item");
          $('#messages').append(tempLi);
          $('#messages').scrollTop($('#messages')[0].scrollHeight);
        });
        
        socket.on('card clear', function(msg){
           $('#cards').empty(); 
        });
        
        function getURL(card) {
            if (isNaN(card.value)) {
                if (card.value == 'reverse') {
                    var cardNum = 10;
                } else if (card.value == 'skip') {
                    var cardNum = 11;
                } else if (card.value == 'draw two') {
                    var cardNum = 12;
                } else if (card.value == 'wild') {
                    var cardNum = 13;
                } else if (card.value == 'draw four') {
                    var cardNum = 14;
                } else {
                    console.log("Error with getURL method");
                    var cardNum = 0;
                }
            } else {
                var cardNum = card.value;
            }
            return "/(" + cardNum + ").jpeg";
            
        }
        
        function getColor(card) {
            if (card.value != "wild" && card.value != "draw four") {
                return card.color;
            } else {
                return '';
            }
        }
        
        // Checks if the game was won.
        function victoryCheck() {
            if (document.getElementById("cards").children.length == 1) {
                socket.emit('uno');
            } else if (document.getElementById("cards").children.length == 0) {
                socket.emit('victory');
            } else {
            
            }
        }
      });
    </script>
  </body>
</html>